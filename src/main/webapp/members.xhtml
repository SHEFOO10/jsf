<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<h:head>
	<title>Members Management</title>
	<meta charset="UTF-8" />
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<style>
		h5 {
			padding: 0;
			margin: 0;
		}
	</style>
</h:head>
<h:body>

	<ui:composition template="/WEB-INF/includes/layouts/layout.xhtml">
		<ui:define name="content">

			<h:form id="memberForm" enctype="multipart/form-data">
				<h3 style="text-align: center">Members List</h3>
				<div id="tableWrapper">

					<h:panelGroup>
						<div class="d-flex flex-wrap">
							<ui:repeat value="#{memberBean.members}" var="member">
								<div class="card" style="width: 18rem; margin: 15px;">
									<img src="#{resource[member.profileImg]}" class="card-img-top" alt="..." />
									<div class="card-body">
										<h5 class="card-title text-center">#{member.name}</h5>
										<div class="ms-3">
											<p>National Id: #{member.national_id}</p>
											<p>Phone: #{member.phone}</p>
											<p>Email: #{member.email}</p>
											<p>Date of Birth:
												<h:outputText value="#{member.date_of_birth}">
													<f:convertDateTime pattern="yyyy-MM-dd" />
												</h:outputText>
											</p>
											<hr />
											<h6>Skills</h6>
											<h:panelGroup rendered="#{member.skills.size() > 0}">
												<div>
													<ui:repeat value="#{member.skills}" var="skill">
														<span class="btn btn-warning mx-1 mb-2">#{skill.name}</span>
													</ui:repeat>
												</div>
											</h:panelGroup>
											<h:panelGroup rendered="#{empty member.skills}">
												<p>No Skills</p>
											</h:panelGroup>
										</div>
										<hr />
										<div class="text-center mt-3">
											<!-- Delete Member Button -->
											<h:commandButton class="btn btn-danger mx-1" value="Delete"
												action="#{memberBean.deleteMember(member.id)}" immediate="true" />

											<!-- Edit Member Button -->
											<h:commandButton class="btn btn-primary mx-1" value="Edit"
												action="#{memberBean.editMember(member.id)}" />

										</div>
									</div>
								</div>
							</ui:repeat>
						</div>

					</h:panelGroup>
				</div>
				<div id="formDiv">

					<!-- Form for creating/editing a member -->
					<h3>#{memberBean.newMember.id == 0 ? 'Create New Member' : 'Edit Member'}</h3>
					<div id="formContainer">
						<div class="block">
							<h:outputLabel for="file" value="Upload Profile Picture:" />
							<p:fileUpload id="file" value="#{memberBean.file}" mode="simple" class="file-upload">
								<f:validator validatorId="imageFileValidator" />
							</p:fileUpload>
							<h:message for="file" style="color: red;" />
						</div>

						<div class="block">
							<h:outputLabel for="name" value="Name:" />
							<h:inputText id="name" value="#{memberBean.newMember.name}" />
							<p>
								<h:message for="name" />
							</p>
						</div>

						<div class="block">
							<h:outputLabel for="national_id" value="National ID:" />
							<h:inputText id="national_id" value="#{memberBean.newMember.national_id}" validatorMessage="National ID must be a 14-digit number.">
								<f:validateRegex pattern="\d{14}" />
							</h:inputText>
							<p>
								<h:message for="national_id" />
							</p>
						</div>

						<div class="block">
							<h:outputLabel for="phone" value="Phone:" />
							<h:inputText id="phone" value="#{memberBean.newMember.phone}" validatorMessage="Phone number must start with + and contain only numbers.">
								<f:validateRegex pattern="\+\d+" />
							</h:inputText>
							<p>
								<h:message for="phone" />
							</p>
						</div>

						<div class="block">
							<h:outputLabel for="email" value="Email:" />
							<h:inputText id="email" value="#{memberBean.newMember.email}"
								validatorMessage="Please enter a valid email address.">
								<f:validateRegex pattern="^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}$" />
								<f:attribute name="memberId" value="#{memberBean.newMember.id}" />
								<f:validator binding="#{memberBean.emailValidator}" />
							</h:inputText>
							<p>
								<h:message for="email" />
							</p>
						</div>

						<div class="block">
							<h:outputLabel for="dob" value="Date of Birth:" />
							<h:inputText id="dob" value="#{memberBean.newMember.date_of_birth}">
								<f:passThroughAttribute name="type" value="date" />
							</h:inputText>

							<p>
								<h:message for="dob" />
							</p>
						</div>

						<div class="block">
							<h:outputLabel for="address" value="Address:" />
							<h:inputTextarea id="address" value="#{memberBean.newMember.address}" />
							<p>
								<h:message for="address" />
							</p>
						</div>
					</div>


					<div id="Btns">
						<h:commandButton value="Save" action="#{memberBean.addMember}" />
						<h:commandButton value="Reset" action="#{memberBean.resetInputs}" />
					</div>
				</div>

				<h:messages globalOnly="true" />
			</h:form>

		</ui:define>
	</ui:composition>

</h:body>

</html>