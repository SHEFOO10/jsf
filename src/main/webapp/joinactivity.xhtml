<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<h:head>
	<title>Member Activities</title>
</h:head>
<h:body>
	<ui:composition template="/WEB-INF/includes/layouts/layout.xhtml">
		<ui:define name="content">


		<div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%)">
			<h:form id="errorForm" >
				<h:panelGroup id="popup" rendered="#{activityBean.showErrorPopup}">
					<h:panelGroup layout="block" styleClass="popup-container" class="d-flex" style="position: relative; background-color: #97d3db; border-radius: 20px; height: 300px; padding: 35px; flex-direction: column; gap: 20px; justify-content: center;">
						<h:commandButton id="closePopup" value="X" action="#{activityBean.closePopup}" class="btn btn-danger mx-2" style="width: 40px; position: absolute; right: 20px; top: 20px;">
							<f:ajax execute="@this" render="@form" />
						</h:commandButton>
						<h3>
							<h:outputText value="Error Message" />
						</h3>
						<h3>
							<h:outputText value="#{activityBean.errorMessage}" />
						</h3>
						
						<div class="d-flex justify-content-end">
							<h:commandButton value="Ok" action="#{activityBean.closePopup}" styleClass="okBtn" class="btn btn-primary mx-2" style="width: 100px;">
								<f:ajax execute="@this" render="@form" />
							</h:commandButton>
						</div>
					</h:panelGroup>
				</h:panelGroup>
			</h:form>
		</div>



			<h:form>
				<div style="text-align: center; margin-block: 20px">
					<div class="form-group" style="display: flex; justify-content: center; align-items: center; gap: 10px;">
						<h:outputLabel for="memberId" value="Member : " style="font-weight: bold;" />
						<h:selectOneMenu id="memberId" value="#{activityBean.memberId}" style="padding: 5px; border-radius: 5px; border: 1px solid #ccc;">
							<f:selectItems value="#{activityBean.members}" var="member" itemValue="#{member.id}" itemLabel="#{member.name}" />
						</h:selectOneMenu>
						<h:commandButton value="Search" action="#{activityBean.searchActivities}" class="btn btn-primary" style="padding: 5px 10px; border-radius: 5px;" />
					</div>
					<p>
						<h:message for="memberId" style="color: blue;" />
					</p>
				</div>
				<div id="d-flex justify-content-center">

					<h:panelGroup rendered="${not empty activityBean.member}" class="d-flex justify-content-center mb-3"
						style="height: 300px; gap: 50px">

						<div style="display:flex; flex-direction: column; justify-content: space-evenly; height: 100%;">
							<div>
								<h:outputLabel>Member Name: </h:outputLabel>
								<h:outputText value="#{activityBean.member.name}" />
							</div>
							<div>
								<h:outputLabel>email: </h:outputLabel>
								<h:outputText value="#{activityBean.member.email}" />
							</div>
							<div>
								<h:outputLabel>National id: </h:outputLabel>
								<h:outputText value="#{activityBean.member.national_id}" />
							</div>
							<div>
								<h:outputLabel>Phone: </h:outputLabel>
								<h:outputText value="#{activityBean.member.phone}" />
							</div>
							<div>
								<h:outputLabel>Date Of Birth: </h:outputLabel>
								<h:outputText value="#{activityBean.member.date_of_birth}" />
							</div>
							<div>
								<h:outputLabel>Skills:
									<h:outputText value="#{activityBean.member.getSkillsAsString()}"
										rendered="#{activityBean.member.skills.size() > 0}" />
									<h:outputText value="No Skills "
										rendered="#{activityBean.member.skills.size() == 0}" />
								</h:outputLabel>
							</div>
						</div>
						<div>
							<img src="#{resource[activityBean.member.profileImg]}" width="100%" height="100%"
								style="border-radius: 10px;" />
						</div>
					</h:panelGroup>
					<div class="d-flex" style="gap: 20px; margin-inline: 20px;">
						<h:panelGroup rendered="#{not empty activityBean.availableActivities}">
							<div class="flexItem">
								<h:outputText value="Available Activities" style="font-weight: bold;" />
								<h:dataTable class="table align-middle mb-0 bg-white"
									value="#{activityBean.availableActivities}" var="activity">
									<h:column>
										<f:facet name="header">Name</f:facet>
										<h:outputText value="#{activity.name}" />
									</h:column>
									<h:column>
										<f:facet name="header">Description</f:facet>
										<h:outputText value="#{activity.description}" />
									</h:column>
									<h:column>
										<f:facet name="header">Required Skills</f:facet>
										<h:outputText value="#{activity.getSkillsAsString()}"
											rendered="#{activity.skills.size() > 0}" />
										<h:outputText value="No Skills Required"
											rendered="#{activity.skills.size() == 0}" />
									</h:column>
									<h:column>
										<!-- Edit Member Button -->
										<h:commandButton class="btn btn-primary" value="Join"
											action="#{activityBean.joinActivity(activity.id)}" />

									</h:column>

								</h:dataTable>
							</div>
						</h:panelGroup>
						<h:panelGroup rendered="#{not empty activityBean.joinedActivities}">
							<div class="flexItem">
								<h:outputText value="Joined Activities" style="font-weight: bold;" />
								<h:dataTable value="#{activityBean.joinedActivities}" var="activity" class="table align-middle">
									<h:column>
										<f:facet name="header">Name</f:facet>
										<h:outputText value="#{activity.name}" />
									</h:column>
									<h:column>
										<f:facet name="header">description</f:facet>
										<h:outputText value="#{activity.description}" />
									</h:column>
									<h:column>
										<!-- Edit Member Button -->
										<h:commandButton class="btn btn-danger" value="Leave"
											action="#{activityBean.leaveActivity(activity.id)}" />

									</h:column>
								</h:dataTable>
							</div>
						</h:panelGroup>
					</div>
				</div>

			</h:form>
		</ui:define>
	</ui:composition>

</h:body>

</html>